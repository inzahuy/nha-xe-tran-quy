<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt Vé Nhà Xe Trần Quý</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen p-4">
    <div class="max-w-md mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-2xl font-black tracking-tighter">NHÀ XE TRẦN QUÝ</h1>
            <p class="text-slate-400">Hệ thống đặt ghế trực tuyến 24/7</p>
        </header>

        <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700">
            <div class="grid grid-cols-4 gap-4 mb-8">
                <div class="col-start-4 p-3 border-2 border-slate-600 rounded-lg text-center opacity-50">
                    Lái
                </div>
                
                {% for id, info in seats.items() %}
                <button 
                    onclick="selectSeat('{{ id }}')"
                    id="seat-{{ id }}"
                    class="p-3 rounded-lg font-bold transition-all duration-200 {% if info %} bg-red-600 cursor-not-allowed {% else %} bg-slate-700 hover:bg-emerald-500 {% endif %}"
                    {% if info %} disabled {% endif %}>
                    {{ id }}
                </button>
                {% endfor %}
            </div>

            <div id="booking-form" class="hidden space-y-4 border-t border-slate-700 pt-6">
                <h3 class="text-lg font-bold">Thông tin ghế số <span id="selected-seat-display"></span></h3>
                <input type="text" id="cust-name" placeholder="Họ và tên" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg focus:outline-none focus:border-emerald-500">
                <input type="text" id="cust-phone" placeholder="Số điện thoại" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg focus:outline-none focus:border-emerald-500">
                <button onclick="confirmBooking()" class="w-full bg-emerald-600 hover:bg-emerald-500 p-3 rounded-lg font-bold">XÁC NHẬN ĐẶT VÉ</button>
            </div>
        </div>
    </div>

    <script>
        let selectedSeat = null;

        function selectSeat(id) {
            selectedSeat = id;
            document.getElementById('booking-form').classList.remove('hidden');
            document.getElementById('selected-seat-display').innerText = id;
        }

        async function confirmBooking() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;

            if(!name || !phone) return alert('Điền đủ thông tin vào!');

            const res = await fetch('/book', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({seat_id: selectedSeat, name: name, phone: phone})
            });

            const result = await res.json();
            alert(result.message);
            if(result.status === 'success') location.reload();
        }
    </script>
</body>
</html>